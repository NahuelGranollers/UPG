import{u as W,j as e,g as _}from"./index-CsF5RlQ1.js";import{r as u,f as k,X,u as z,g as M,P as R,Z as A,Q as T,k as q,E as H,Y as J,T as Z,t as g,_ as K,n as Q}from"./ui-CVbPK0x6.js";import"./vendor-Bzgz95E1.js";import"./socket-CA1CrNgP.js";const Y=({socket:l})=>{const[n,i]=u.useState([]),[r,h]=u.useState(!1);return u.useEffect(()=>{if(!l||!l.connected)return;const b=o=>{const w=`[${new Date().toLocaleTimeString()}] ${o.message||o}`;i(y=>[...y.slice(-49),w])};return r||(l.emit("admin:subscribe-logs"),l.on("admin:log-entry",b),h(!0)),()=>{l&&r&&(l.emit("admin:unsubscribe-logs"),l.off("admin:log-entry",b),h(!1))}},[l,r]),e.jsxs("div",{className:"discord-glass-subtle p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-discord-text-header font-bold",children:[e.jsx(T,{className:"text-purple-400",size:20}),e.jsx("h3",{children:"Logs del Backend en Tiempo Real"})]}),e.jsx("div",{className:"bg-black/50 rounded p-3 max-h-64 overflow-y-auto custom-scrollbar font-mono text-xs space-y-1",children:n.length===0?e.jsx("div",{className:"text-discord-text-muted text-center py-4",children:"Esperando logs del servidor..."}):n.map((b,o)=>e.jsx("div",{className:"text-discord-text-normal whitespace-pre-wrap break-words",children:b},o))}),e.jsxs("div",{className:"mt-2 text-xs text-discord-text-muted",children:["Mostrando los últimos ",n.length," logs • Estado: ",r?"Conectado":"Desconectado"]})]})},U=({socket:l})=>{var C,j,m;const[n,i]=u.useState(null),[r,h]=u.useState(!0),[b,o]=u.useState(null);u.useEffect(()=>{fetch("https://api.mcsrvstat.us/2/mc.unaspartidillas.online").then(I=>I.json()).then(I=>{i(I),h(!1)}).catch(()=>h(!1));const p=Date.now();fetch(`${_()}/api/health`).then(()=>o(Date.now()-p)).catch(()=>o(-1))},[]);const f=(l==null?void 0:l.connected)??!1,w=(l==null?void 0:l.id)||"-",y=((m=(j=(C=l==null?void 0:l.io)==null?void 0:C.engine)==null?void 0:j.transport)==null?void 0:m.name)||"Unknown";return e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"discord-glass-subtle p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-discord-text-header font-bold",children:[e.jsx(K,{className:"text-green-400",size:20}),e.jsx("h3",{children:"Servidor Minecraft"})]}),r?e.jsx("div",{className:"animate-pulse h-20 bg-discord-surface rounded"}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-discord-text-muted",children:"Estado"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${n!=null&&n.online?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:n!=null&&n.online?"ONLINE":"OFFLINE"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-discord-text-muted",children:"IP"}),e.jsx("span",{className:"text-discord-text-normal font-mono text-sm",children:"mc.unaspartidillas.online"})]}),(n==null?void 0:n.online)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-discord-text-muted",children:"Jugadores"}),e.jsxs("span",{className:"text-discord-text-normal",children:[n.players.online," / ",n.players.max]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-discord-text-muted",children:"Versión"}),e.jsx("span",{className:"text-discord-text-normal text-xs",children:"1.20.4 - 1.21.10"})]})]})]})]}),e.jsxs("div",{className:"discord-glass-subtle p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-discord-text-header font-bold",children:[e.jsx(Q,{className:"text-blue-400",size:20}),e.jsx("h3",{children:"Servidor Web & Socket"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-discord-text-muted",children:"Socket.IO"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${f?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:f?"CONECTADO":"DESCONECTADO"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-discord-text-muted",children:"ID de Sesión"}),e.jsx("span",{className:"text-discord-text-normal font-mono text-xs truncate max-w-[150px]",children:w})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-discord-text-muted",children:"Latencia API"}),e.jsx("span",{className:`font-mono text-sm ${!b||b>500?"text-red-400":"text-green-400"}`,children:b?`${b}ms`:"Calculando..."})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-discord-text-muted",children:"Transporte"}),e.jsx("span",{className:"text-discord-text-normal text-xs uppercase",children:y})]})]})]})]}),e.jsx(Y,{socket:l})]})},ee=u.memo(({isOpen:l,onClose:n,currentUser:i,socket:r})=>{const h=a=>{j({action:a,values:{}}),p({})},{users:b}=W(),[o,f]=u.useState(!1),[w,y]=u.useState(null),[C,j]=u.useState(null),[m,p]=u.useState({}),[I,G]=u.useState([]),[S,P]=u.useState(!1),O=u.useMemo(()=>b.filter(a=>!a.isBot&&a.id!==(i==null?void 0:i.id)),[b,i]);if(!l)return null;if(!r)return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn",children:e.jsxs("div",{className:"discord-card max-w-md w-full p-8 border-red-600 flex flex-col items-center",children:[e.jsx(k,{className:"w-10 h-10 text-red-600 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-2",children:"Error de conexión"}),e.jsx("p",{className:"text-base text-discord-text-normal mb-4 text-center",children:"No se ha detectado conexión con el servidor."}),e.jsx("button",{onClick:n,className:"discord-button danger",children:"Cerrar"})]})});const L=async(a,s=!0)=>{if(s&&w!==a){y(a),setTimeout(()=>y(null),5e3);return}f(!0),y(null);try{const t=(c,d)=>new Promise(N=>{try{r==null||r.emit(c,d,E=>N(E)),setTimeout(()=>N(null),2e3)}catch{N({ok:!1,error:"emit_error"})}});let x=null;switch(a){case"clear-messages":{i&&(x=await t("admin:clear-all-messages",{adminId:i.id}));break}case"silence-user":{const c=m.userId||"";c&&i&&(x=await t("admin:silence-user",{userId:c,adminId:i.id})),j(null);break}case"change-color":{const c=m.userId||"",d=m.color||"";c&&d&&i&&(x=await t("admin:change-color",{userId:c,color:d,adminId:i.id})),j(null);break}case"global-message":{const c=m.message||"";if(c&&i){const d={content:c,adminId:i.id};(m.sendAsBot==="true"||m.sendAsBot===!0)&&(d.sendAsBot=!0,m.channelId&&(d.channelId=m.channelId)),x=await t("admin:global-message",d)}j(null);break}case"troll-mode":{const c=m.userId||"";if(c&&i){let d=m.mode||null;(d==="clear"||d==="")&&(d=null),x=await t("admin:troll-mode",{userId:c,mode:d,adminId:i.id})}j(null);break}case"reset-ips-cache":{i&&(x=await t("admin:reset-ips-cache",{adminId:i.id}));break}}x&&x.ok===!1?g.error(x.error||"Error ejecutando la acción"):g.success("Acción enviada con éxito")}catch{g.error("Error ejecutando la acción")}finally{setTimeout(()=>f(!1),1e3)}},$=async()=>{P(!0);try{const s=await((t,x)=>new Promise(c=>{try{r==null||r.emit(t,x,d=>c(d)),setTimeout(()=>c(null),2e3)}catch{c({ok:!1,error:"emit_error"})}}))("admin:get-active-rooms",{adminId:i==null?void 0:i.id});s&&s.ok?G(s.rooms||[]):g.error("Error al cargar salas activas")}catch{g.error("Error al cargar salas activas")}finally{P(!1)}},B=async(a,s)=>{f(!0);try{const x=await((c,d)=>new Promise(N=>{try{r==null||r.emit(c,d,E=>N(E)),setTimeout(()=>N(null),2e3)}catch{N({ok:!1,error:"emit_error"})}}))(`admin:${a}`,{adminId:i==null?void 0:i.id,roomId:s});x&&x.ok?(g.success(`Sala ${a==="delete-room"?"eliminada":"terminada"} exitosamente`),$()):g.error((x==null?void 0:x.error)||`Error al ${a==="delete-room"?"eliminar":"terminar"} la sala`)}catch{g.error(`Error al ${a==="delete-room"?"eliminar":"terminar"} la sala`)}finally{setTimeout(()=>f(!1),1e3)}},V=async a=>{f(!0);try{const t=await((x,c)=>new Promise(d=>{try{r==null||r.emit(x,c,N=>d(N)),setTimeout(()=>d(null),2e3)}catch{d({ok:!1,error:"emit_error"})}}))("admin:join-room-as-admin",{adminId:i==null?void 0:i.id,roomId:a});t&&t.ok?(g.success("Te has unido a la sala como observador"),j(null)):g.error((t==null?void 0:t.error)||"Error al unirte a la sala")}catch{g.error("Error al unirte a la sala")}finally{setTimeout(()=>f(!1),1e3)}},D=({value:a,onChange:s})=>e.jsxs("select",{value:a,onChange:t=>s(t.target.value),className:"w-full discord-input",children:[e.jsx("option",{value:"",children:"-- Seleccionar Usuario --"}),O.map(t=>e.jsxs("option",{value:t.id,children:[t.username," ",t.status==="offline"?"(Offline)":""]},t.id))]}),F=()=>{if(!C)return null;const{action:a}=C;return a==="system-status"?e.jsxs("div",{className:"discord-panel animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-discord-text-header flex items-center gap-2",children:[e.jsx(T,{size:20}),"Estado del Sistema"]}),e.jsx("button",{onClick:()=>j(null),className:"discord-button secondary text-xs py-1 px-2",children:"Volver"})]}),e.jsx(U,{socket:r})]}):a==="room-management"?e.jsxs("div",{className:"discord-panel animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-discord-text-header flex items-center gap-2",children:[e.jsx(k,{size:20}),"Gestión de Salas"]}),e.jsx("button",{onClick:()=>j(null),className:"discord-button secondary text-xs py-1 px-2",children:"Volver"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:$,className:"discord-button w-full",disabled:S,children:S?"Cargando...":"Actualizar Lista"}),S?e.jsx("div",{className:"text-center py-8 text-discord-text-muted animate-pulse",children:"Cargando salas activas..."}):I.length===0?e.jsx("div",{className:"text-center py-8 text-discord-text-muted",children:"No hay salas activas"}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:I.map(s=>e.jsxs("div",{className:"discord-glass-subtle p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-discord-text-header",children:s.name}),e.jsxs("p",{className:"text-sm text-discord-text-muted",children:["Host: ",s.hostName," • ",s.playerCount,"/10 jugadores"]}),e.jsxs("p",{className:"text-xs text-discord-text-normal",children:["Estado: ",s.started?"En juego":"Esperando"," •",s.hasPassword?"Privada":"Pública"]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-bold ${s.started?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:s.started?"ACTIVA":"ESPERANDO"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>V(s.roomId),className:"flex-1 discord-button secondary text-xs py-2",disabled:o,children:[e.jsx(H,{size:14,className:"inline mr-1"}),"Observar"]}),s.started&&e.jsxs("button",{onClick:()=>B("terminate-room",s.roomId),className:"flex-1 discord-button warning text-xs py-2",disabled:o,children:[e.jsx(J,{size:14,className:"inline mr-1"}),"Terminar"]}),e.jsxs("button",{onClick:()=>B("delete-room",s.roomId),className:"flex-1 discord-button danger text-xs py-2",disabled:o,children:[e.jsx(Z,{size:14,className:"inline mr-1"}),"Eliminar"]})]})]},s.roomId))})]})]}):e.jsxs("div",{className:"discord-panel animate-fadeIn",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-discord-text-header flex items-center gap-2",children:[a==="change-color"&&e.jsx(R,{size:20}),a==="global-message"&&e.jsx(z,{size:20}),a==="silence-user"&&e.jsx(M,{size:20}),a==="troll-mode"&&e.jsx(A,{size:20}),a==="trigger-effect"&&e.jsx(A,{size:20}),a==="change-color"?"Cambiar Color":a==="global-message"?"Mensaje Global":a==="silence-user"?"Silenciar Usuario":a==="troll-mode"?"Modo Troll":"Efecto Gracioso"]}),e.jsxs("div",{className:"space-y-4",children:[(a==="silence-user"||a==="change-color"||a==="troll-mode"||a==="trigger-effect")&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-discord-text-muted mb-1 block",children:"Usuario Objetivo"}),e.jsx(D,{value:m.userId||"",onChange:s=>p(t=>({...t,userId:s}))})]}),a==="change-color"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-discord-text-muted mb-1 block",children:"Color HEX"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:m.color||"#ffffff",onChange:s=>p(t=>({...t,color:s.target.value})),className:"h-10 w-14 bg-transparent cursor-pointer"}),e.jsx("input",{value:m.color||"",onChange:s=>p(t=>({...t,color:s.target.value})),className:"flex-1 discord-input",placeholder:"#RRGGBB"})]})]}),a==="global-message"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-discord-text-muted mb-1 block",children:"Mensaje"}),e.jsx("textarea",{value:m.message||"",onChange:s=>p(t=>({...t,message:s.target.value})),className:"w-full discord-input",rows:3,placeholder:"Escribe tu mensaje aquí..."}),e.jsx("div",{className:"flex items-center gap-3 mt-3",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.sendAsBot==="true",onChange:s=>p(t=>({...t,sendAsBot:s.target.checked?"true":"false"})),className:"rounded bg-discord-dark border-gray-600"}),e.jsx("span",{className:"text-discord-text-normal",children:"Enviar como Bot"})]})})]}),a==="troll-mode"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-discord-text-muted mb-1 block",children:"Tipo de Troll"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"uwu",label:"UwUify",desc:"Convierte todo a UwU"},{id:"meow",label:"Meowify",desc:"Agrega maullidos"},{id:"kawaii",label:"Kawaii",desc:"Exceso de ternura"},{id:"",label:"Desactivar",desc:"Volver a la normalidad",danger:!0}].map(s=>e.jsxs("button",{onClick:()=>p(t=>({...t,mode:s.id})),className:`p-2 rounded border text-left transition-all ${m.mode===s.id?"bg-discord-blurple border-discord-blurple text-white":s.danger?"border-red-500/50 hover:bg-red-500/10 text-red-400":"border-discord-hover hover:bg-discord-hover text-discord-text-normal"}`,children:[e.jsx("div",{className:"font-bold text-sm",children:s.label}),e.jsx("div",{className:"text-xs opacity-70",children:s.desc})]},s.id))})]}),a==="trigger-effect"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-discord-text-muted mb-1 block",children:"Efecto"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"rotate",label:"Rotar Pantalla",desc:"Gira la pantalla 180°"},{id:"confetti",label:"Confeti",desc:"Explosión de alegría"},{id:"jumpscare",label:"Susto (Suave)",desc:"Imagen rápida"},{id:"fart",label:"Sonido Gracioso",desc:"Sonido de pedo"}].map(s=>e.jsxs("button",{onClick:()=>p(t=>({...t,effect:s.id})),className:`p-2 rounded border text-left transition-all ${m.effect===s.id?"bg-discord-blurple border-discord-blurple text-white":"border-discord-hover hover:bg-discord-hover text-discord-text-normal"}`,children:[e.jsx("div",{className:"font-bold text-sm",children:s.label}),e.jsx("div",{className:"text-xs opacity-70",children:s.desc})]},s.id))})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4 border-t border-discord-border mt-2",children:[e.jsx("button",{onClick:()=>j(null),className:"discord-button secondary",children:"Cancelar"}),e.jsx("button",{onClick:()=>L(a,!1),className:"discord-button",children:"Aplicar"})]})]})]})};return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn",onClick:n,children:e.jsxs("div",{className:"discord-card max-w-2xl w-full max-h-[90vh] overflow-hidden animate-scaleIn flex flex-col",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"bg-discord-blurple p-4 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-6 h-6 text-white"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Panel de Administración"})]}),e.jsx("button",{onClick:n,className:"text-white hover:bg-white/20 rounded p-1 transition-colors","aria-label":"Cerrar",children:e.jsx(X,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6",children:C?F():e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(v,{icon:e.jsx(z,{size:24}),title:"Limpiar Chat",description:"Borrar todos los mensajes",onClick:()=>L("clear-messages"),isConfirming:w==="clear-messages",isLoading:o,variant:"danger"}),e.jsx(v,{icon:e.jsx(M,{size:24}),title:"Silenciar",description:"Mutear a un usuario",onClick:()=>h("silence-user"),isConfirming:!1,isLoading:o,variant:"warning"}),e.jsx(v,{icon:e.jsx(R,{size:24}),title:"Cambiar Color",description:"Personalizar nombre",onClick:()=>h("change-color"),isConfirming:!1,isLoading:o,variant:"info"}),e.jsx(v,{icon:e.jsx(z,{size:24}),title:"Anuncio Global",description:"Enviar mensaje a todos",onClick:()=>h("global-message"),isConfirming:!1,isLoading:o,variant:"success"}),e.jsx(v,{icon:e.jsx(A,{size:24}),title:"Modo Troll",description:"Modificar chat del usuario",onClick:()=>h("troll-mode"),isConfirming:!1,isLoading:o,variant:"warning"}),e.jsx(v,{icon:e.jsx(A,{size:24}),title:"Efecto Gracioso",description:"Rotar pantalla, sonidos...",onClick:()=>h("trigger-effect"),isConfirming:!1,isLoading:o,variant:"warning"}),e.jsx(v,{icon:e.jsx(T,{size:24}),title:"Estado del Sistema",description:"Ver métricas del servidor",onClick:()=>h("system-status"),isConfirming:!1,isLoading:o,variant:"info"}),e.jsx(v,{icon:e.jsx(q,{size:24}),title:"Gestionar Salas",description:"Ver, unirte y eliminar salas activas",onClick:()=>h("room-management"),isConfirming:!1,isLoading:o,variant:"info"})]})}),e.jsx("div",{className:"bg-discord-dark p-3 border-t border-discord-border shrink-0",children:e.jsxs("p",{className:"text-xs text-discord-text-muted text-center",children:["Admin: ",i==null?void 0:i.username]})})]})})}),v=u.memo(({icon:l,title:n,description:i,onClick:r,isConfirming:h,isLoading:b,variant:o})=>{const f={danger:"bg-red-500/10 border-red-500/50 hover:bg-red-500/20 text-red-400",warning:"bg-yellow-500/10 border-yellow-500/50 hover:bg-yellow-500/20 text-yellow-400",info:"bg-blue-500/10 border-blue-500/50 hover:bg-blue-500/20 text-blue-400",success:"bg-green-500/10 border-green-500/50 hover:bg-green-500/20 text-green-400"};return e.jsxs("button",{onClick:r,disabled:b,className:`p-4 rounded-lg border transition-all flex flex-col items-center text-center gap-2 ${h?"bg-red-600 border-red-500 text-white animate-pulse":f[o]} ${b?"opacity-50 cursor-not-allowed":"hover:scale-[1.02]"}`,children:[e.jsx("div",{className:h?"text-white":"",children:l}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg",children:h?"¿Confirmar?":n}),e.jsx("p",{className:"text-xs opacity-80",children:h?"Clic para ejecutar":i})]})]})});v.displayName="ActionButton";ee.displayName="AdminPanel";export{ee as default};
